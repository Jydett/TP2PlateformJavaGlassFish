<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Livre d'or</title>
        <h:outputStylesheet library="webjars" name="bootstrap/3.2.0/css/bootstrap.min.css"/>
        <h:outputStylesheet library="webjars" name="font-awesome/4.7.0/css/font-awesome.min-jsf.css"/>
        <h:outputStylesheet library="css" name="roundedButton.css"/>
    </h:head>
    <h:body style="margin-top: 75px">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">
                <ul class="nav navbar-nav">
                    <li><a href="home.xhtml"><i class="fa fa-home"/> Acceuil</a></li>
                    <li class="active"><a><i class="fa fa-comments"/> Livre d'or</a></li>
                </ul>
                <c:choose>
                    <c:when test="#{connectedUser.connected}">
                        <h:form class="navbar-right">
                            <p class="navbar-text"><i class="fa fa-user-o"/> #{connectedUser.member.username}</p>
                            <h:commandButton value="Se déconnecter" action="#{connectedUser.disconnect}" styleClass="navbar-btn btn btn-default"/>
                        </h:form>
                    </c:when>
                    <c:otherwise>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="signin.xhtml"><i class="fa fa-user-o"/> S'enregistrer</a></li>
                            <li><a href="login.xhtml"><i class="fa fa-sign-in"/> Se Connecter</a></li>
                        </ul>
                    </c:otherwise>
                </c:choose>
            </div>
        </nav>
        <div class="container">
            <div class="row">
                <div class="col-lg-10">
                    <h1>Le livre d'or</h1>
                    <h:graphicImage library="img" name="logo.jpg"/>
<!--                    <h3>Page #{messages.currentPage.pageNumber} sur #{messages.currentPage.numberOfPages} (#{messages.currentPage.totalResult} commentaires)</h3>-->
                    <h:form>
                        <c:forEach var="i" begin="1" end="#{messages.currentPage.numberOfPages}">
                            <h:commandButton action="#{messages.changeCurrentPage(i)}" value="#{i}" styleClass="btn btn-circle btn-sm #{messages.currentPage.pageNumber == i ? 'active btn-primary' : 'btn-default'}"/>
                        </c:forEach>
                        (#{messages.currentPage.totalResult} commentaires)
                    </h:form>
                    <br/>
                    <h:form>
                        <h:dataTable value="#{messages.currentPage.list}" var="message">
                            <h:column>
                                <h:commandButton action="#{messages.upvote(message.id)}" value="&#xf087;" rendered="#{connectedUser.connected}" styleClass="fa btn-circle btn-success"/><!--TODO voter qu'une fois -->
                                <strong style="margin-right: 3px">#{message.reputation}</strong>
                                <h:commandButton action="#{messages.downvote(message.id)}" value="&#xf088;" rendered="#{connectedUser.connected}" styleClass="fa btn-circle btn-danger"/>
                            </h:column>
                            <h:column>
                                <h3 style="margin-top: 0">
                                    <i class="fa fa-comment"/>
                                    <h:outputText rendered="#{message.author.administrator}" style="color: red" value=" #{message.author.username}"/>
                                    <h:outputText rendered="#{not message.author.administrator}" value=" #{message.author.username}"/>
                                a dit: <small>le #{message.formattedPostedDate} à #{message.formattedPostedTime}</small></h3>
                                <p>#{message.message}</p>
                            </h:column>
                            <h:column rendered="#{connectedUser.isAdminOrId(message.id)}">
                                <h:commandButton action="#{messages.delete(message.id)}" value="X"/>
                            </h:column>
                        </h:dataTable>
                    </h:form>
                    <c:choose>
                        <c:when test="#{connectedUser.connected}">
                            <div class="well">
                                <h4><i class="fa fa-paper-plane-o"/> Laisser un commentaire :</h4>
                                <h:form role="form">
                                    <h:messages style="color: red" layout="table"/>
                                    <div class="form-group">
                                        <h:inputTextarea id="message" value="#{newMessage.message}"
                                            required="true" requiredMessage="Votre commentaire ne peux pas être vide"
                                            style="width: 100%" rows="3"
                                        >
                                            <f:validateLength maximum="200" />
                                        </h:inputTextarea>
                                    </div>
                                    <h:commandButton action="#{newMessage.post}" value="&#xf112;&nbsp;&nbsp;Poster" styleClass="btn btn-primary fa"/>
                                </h:form>
                            </div>
                        </c:when>
                        <c:otherwise>
                            Vous devez vous connecter pour poster un message !
                            <a href="login.xhtml">Se connecter</a>
                        </c:otherwise>
                    </c:choose>
                </div>
            </div>
        </div>
    </h:body>
</html>
