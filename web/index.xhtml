<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
       <title>Super site</title>
    </h:head>
    <h:body>
        <h1>Bienvenue sur mon super site</h1>
        <h:graphicImage library="img" name="logo.jpg"/>
        <h3>Page #{messages.currentPage.pageNumber} sur #{messages.currentPage.numberOfPages} (#{messages.currentPage.totalResult} commentaires)</h3>
        <h:form>
            <c:forEach var="i" begin="1" end="#{messages.currentPage.numberOfPages}">
                <h:commandButton action="#{messages.changeCurrentPage(i)}" value="#{i}"/>
            </c:forEach>
        </h:form>
        <h:dataTable value="#{messages.currentPage.list}" var="message">
            <h:column>
                <h:commandButton action="#{messages.upvote(message.id)}" value="+" rendered="#{connectedUser.connected}"/>
                #{message.reputation}
                <h:commandButton action="#{messages.downvote(message.id)}" value="-" rendered="#{connectedUser.connected}"/>
            </h:column>
            <h:column>
            <span style="color:gray;">
                <h:outputText rendered="#{message.author.administrator}" style="color: red" value="#{message.author.username}"/>
                <h:outputText rendered="#{not message.author.administrator}" value="#{message.author.username}"/>
                le #{message.formattedPostedDate} à #{message.formattedPostedTime}:</span>
                <br/>
                #{message.message}
            </h:column>
            <h:column rendered="#{connectedUser.isAdminOrId(message.id)}">
                <h:commandButton action="#{messages.delete(message.id)}" value="X"/>
            </h:column>
        </h:dataTable>
        <c:choose>
            <c:when test="#{connectedUser.connected}">
                <h:form>
                    <h:messages style="color: red" layout="table"/>
                    <h:outputLabel value="Message :"/><br/>
                    <h:inputTextarea id="message" value="#{newMessage.message}"
                                     required="true" requiredMessage="Votre commentaire ne peux pas être vide">
                        <f:validateLength maximum="200" />
                    </h:inputTextarea>
                    <h:commandButton action="#{newMessage.post}" value="Poster"/>
                </h:form>
            </c:when>
            <c:otherwise>
                Vous devez vous connecter pour poster un message !

                <a href="login.xhtml">Se connecter</a>
                <a href="login.xhtml">S'inscrire</a>
            </c:otherwise>
        </c:choose>
    </h:body>
</html>
